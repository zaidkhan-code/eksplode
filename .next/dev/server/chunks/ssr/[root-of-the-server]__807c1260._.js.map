{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 100, "column": 0}, "map": {"version":3,"sources":["file:///D:/eksplode-system/Org%20Code/red-black-org/v0-eksplode-dac-frontend-black-red/lib/useApi.js"],"sourcesContent":["import axios from \"axios\";\r\n\r\nconst baseUrl = process.env.NEXT_PUBLIC_API_URL;\r\n\r\nconst useApi = async (url, options = {}, callBack, notProtected = false) => {\r\n  let response = null;\r\n  let error = null;\r\n\r\n  try {\r\n    const isFormData = options.data instanceof FormData;\r\n\r\n    const accessToken =\r\n      typeof window !== \"undefined\"\r\n        ? localStorage.getItem(\"accessToken\")\r\n        : null;\r\n\r\n    const headers = {\r\n      ...(isFormData ? {} : { \"Content-Type\": \"application/json\" }),\r\n      ...(options.headers || {}),\r\n      ...(accessToken ? { Authorization: `Bearer ${accessToken}` } : {}),\r\n    };\r\n\r\n    const res = await axios({\r\n      url: baseUrl + url,\r\n      method: options.method || \"GET\",\r\n      data: options.data || undefined,\r\n      headers,\r\n      withCredentials: true,\r\n    });\r\n\r\n    response = res.data;\r\n    callBack(response, true);\r\n  } catch (err) {\r\n    console.error(\"Axios error:\", err);\r\n    error = err.response ? err.response.data : err;\r\n\r\n    // ===================================================\r\n    // ðŸš¨ Redirect on 401 BUT skip if path = /auth/login\r\n    // ===================================================\r\n    if (typeof window !== \"undefined\") {\r\n      const currentPath = window.location.pathname; // <-- only path\r\n      const isOnLoginPage = currentPath === \"/auth/login\";\r\n\r\n      if (err?.response?.status === 401 && !isOnLoginPage) {\r\n        localStorage.removeItem(\"accessToken\");\r\n        window.location.href = \"/auth/login\"; // relative redirect\r\n      }\r\n    }\r\n    // ===================================================\r\n\r\n    callBack(error, false);\r\n  }\r\n\r\n  return { response, error };\r\n};\r\n\r\nexport default useApi;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEN,MAAM,SAAS,OAAO,KAAK,UAAU,CAAC,CAAC,EAAE,UAAU,eAAe,KAAK;IACrE,IAAI,WAAW;IACf,IAAI,QAAQ;IAEZ,IAAI;QACF,MAAM,aAAa,QAAQ,IAAI,YAAY;QAE3C,MAAM,cACJ,sCACI,0BACA;QAEN,MAAM,UAAU;YACd,GAAI,aAAa,CAAC,IAAI;gBAAE,gBAAgB;YAAmB,CAAC;YAC5D,GAAI,QAAQ,OAAO,IAAI,CAAC,CAAC;YACzB,GAAI,sCAAc,0BAA6C,CAAC,CAAC;QACnE;QAEA,MAAM,MAAM,MAAM,IAAA,mMAAK,EAAC;YACtB,KAAK,UAAU;YACf,QAAQ,QAAQ,MAAM,IAAI;YAC1B,MAAM,QAAQ,IAAI,IAAI;YACtB;YACA,iBAAiB;QACnB;QAEA,WAAW,IAAI,IAAI;QACnB,SAAS,UAAU;IACrB,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,QAAQ,IAAI,QAAQ,GAAG,IAAI,QAAQ,CAAC,IAAI,GAAG;QAE3C,sDAAsD;QACtD,oDAAoD;QACpD,sDAAsD;QACtD;;QASA,sDAAsD;QAEtD,SAAS,OAAO;IAClB;IAEA,OAAO;QAAE;QAAU;IAAM;AAC3B;uCAEe"}},
    {"offset": {"line": 150, "column": 0}, "map": {"version":3,"sources":["file:///D:/eksplode-system/Org%20Code/red-black-org/v0-eksplode-dac-frontend-black-red/components/Context/AuthContext.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, {\r\n  createContext,\r\n  useContext,\r\n  useState,\r\n  ReactNode,\r\n  useEffect,\r\n} from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\n// import { toast } from \"react-toastify\";\r\nimport useApi from \"../../lib/useApi\"; // make sure your custom hook path is correct\r\nimport { toast } from \"sonner\";\r\n\r\ninterface AuthContextType {\r\n  isLoading: boolean;\r\n  user: any;\r\n  login: (email: string, password: string, rememberMe: boolean) => void;\r\n  register: (\r\n    fullName: string,\r\n    email: string,\r\n    password: string,\r\n    confirmPassword: string,\r\n    role: string\r\n  ) => void;\r\n  logout: () => void;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\nexport const AuthProvider = ({ children }: { children: ReactNode }) => {\r\n  const router = useRouter();\r\n\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [user, setUser] = useState<any>(\r\n    typeof window !== \"undefined\"\r\n      ? JSON.parse(localStorage.getItem(\"user\") || \"null\")\r\n      : null\r\n  );\r\n  const getStoredAuthData = () => {\r\n    if (typeof window === \"undefined\")\r\n      return { accessToken: null, refreshToken: null, user: null };\r\n\r\n    try {\r\n      const accessToken = localStorage.getItem(\"accessToken\");\r\n      const refreshToken = localStorage.getItem(\"refreshToken\");\r\n      const userData = localStorage.getItem(\"user\");\r\n\r\n      return {\r\n        accessToken: accessToken || null,\r\n        refreshToken: refreshToken || null,\r\n        user: userData ? JSON.parse(userData) : null,\r\n      };\r\n    } catch (error) {\r\n      console.error(\"Error reading auth data from localStorage:\", error);\r\n      return { accessToken: null, refreshToken: null, user: null };\r\n    }\r\n  };\r\n\r\n  const protectAuthPages = () => {\r\n    if (user) {\r\n      router.push(\"/\"); // redirect to homepage or dashboard\r\n    }\r\n  };\r\n\r\n  // âœ… LOGIN\r\n  const login = (email: string, password: string, rememberMe: boolean) => {\r\n    setIsLoading(true);\r\n    const payload = { email, password, rememberMe };\r\n\r\n    useApi(\r\n      \"auth/login\",\r\n      { method: \"POST\", data: payload },\r\n      (res: any, status: boolean) => {\r\n        setIsLoading(false);\r\n        if (status) {\r\n          toast.success(res?.message || \"Login successful!\");\r\n          console.log(res, \"check user response please\");\r\n          localStorage.setItem(\"accessToken\", res?.accessToken);\r\n\r\n          localStorage.setItem(\"refreshToken\", res?.refreshToken);\r\n          if (res?.user) {\r\n            localStorage.setItem(\"user\", JSON.stringify(res.user));\r\n            setUser(res.user);\r\n          }\r\n          if (res?.user?.role == \"merchant\" && !res?.user?.webhookSecret) {\r\n            router.push(\"/merchant/webhook-setup\");\r\n          } else {\r\n            router.push(`/${res?.user?.role}/dashboard`);\r\n          }\r\n        } else {\r\n          toast.error(res?.error || \"Invalid email or password!\");\r\n        }\r\n      }\r\n    );\r\n  };\r\n\r\n  // âœ… REGISTER\r\n  const register = ({ fullName, email, password, confirmPassword, role }) => {\r\n    if (password !== confirmPassword) {\r\n      toast.error(\"Passwords do not match\");\r\n      return;\r\n    }\r\n\r\n    if (!role) {\r\n      toast.warning(\"Please select a role\");\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    const payload = { name: fullName, email, password, role };\r\n\r\n    useApi(\r\n      \"auth/register\",\r\n      { method: \"POST\", data: payload },\r\n      (res: any, status: boolean) => {\r\n        setIsLoading(false);\r\n        if (status) {\r\n          toast.success(res?.message || \"Account created successfully!\");\r\n          router.push(\"/auth/login\");\r\n        } else {\r\n          toast.error(res?.message || \"Registration failed!\");\r\n        }\r\n      }\r\n    );\r\n  };\r\n\r\n  // âœ… LOGOUT\r\n  function Logout() {\r\n    useApi(\"auth/logout\", { method: \"POST\" }, (res, status) => {\r\n      // router?.push(\"/auth/login\");\r\n      window.location.href = \"/auth/login\";\r\n      console.log(\"api is calling proper\");\r\n      localStorage.clear();\r\n    });\r\n  }\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        isLoading,\r\n        user,\r\n        login,\r\n        register,\r\n        Logout,\r\n        getStoredAuthData,\r\n        protectAuthPages,\r\n        setUser,\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\n// âœ… useAuth Hook\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error(\"useAuth must be used within an AuthProvider\");\r\n  }\r\n  return context;\r\n};\r\n"],"names":[],"mappings":";;;;;;;AAEA;AAOA;AACA,0CAA0C;AAC1C,+LAAuC,6CAA6C;AACpF;AAZA;;;;;;AA4BA,MAAM,4BAAc,IAAA,qVAAa,EAA8B;AAExD,MAAM,eAAe,CAAC,EAAE,QAAQ,EAA2B;IAChE,MAAM,SAAS,IAAA,8QAAS;IAExB,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,gVAAQ,EAAC;IAC3C,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,gVAAQ,EAC9B,sCACI,0BACA;IAEN,MAAM,oBAAoB;QACxB,wCACE,OAAO;YAAE,aAAa;YAAM,cAAc;YAAM,MAAM;QAAK;;;IAgB/D;IAEA,MAAM,mBAAmB;QACvB,IAAI,MAAM;YACR,OAAO,IAAI,CAAC,MAAM,oCAAoC;QACxD;IACF;IAEA,UAAU;IACV,MAAM,QAAQ,CAAC,OAAe,UAAkB;QAC9C,aAAa;QACb,MAAM,UAAU;YAAE;YAAO;YAAU;QAAW;QAE9C,IAAA,wHAAM,EACJ,cACA;YAAE,QAAQ;YAAQ,MAAM;QAAQ,GAChC,CAAC,KAAU;YACT,aAAa;YACb,IAAI,QAAQ;gBACV,iRAAK,CAAC,OAAO,CAAC,KAAK,WAAW;gBAC9B,QAAQ,GAAG,CAAC,KAAK;gBACjB,aAAa,OAAO,CAAC,eAAe,KAAK;gBAEzC,aAAa,OAAO,CAAC,gBAAgB,KAAK;gBAC1C,IAAI,KAAK,MAAM;oBACb,aAAa,OAAO,CAAC,QAAQ,KAAK,SAAS,CAAC,IAAI,IAAI;oBACpD,QAAQ,IAAI,IAAI;gBAClB;gBACA,IAAI,KAAK,MAAM,QAAQ,cAAc,CAAC,KAAK,MAAM,eAAe;oBAC9D,OAAO,IAAI,CAAC;gBACd,OAAO;oBACL,OAAO,IAAI,CAAC,CAAC,CAAC,EAAE,KAAK,MAAM,KAAK,UAAU,CAAC;gBAC7C;YACF,OAAO;gBACL,iRAAK,CAAC,KAAK,CAAC,KAAK,SAAS;YAC5B;QACF;IAEJ;IAEA,aAAa;IACb,MAAM,WAAW,CAAC,EAAE,QAAQ,EAAE,KAAK,EAAE,QAAQ,EAAE,eAAe,EAAE,IAAI,EAAE;QACpE,IAAI,aAAa,iBAAiB;YAChC,iRAAK,CAAC,KAAK,CAAC;YACZ;QACF;QAEA,IAAI,CAAC,MAAM;YACT,iRAAK,CAAC,OAAO,CAAC;YACd;QACF;QAEA,aAAa;QACb,MAAM,UAAU;YAAE,MAAM;YAAU;YAAO;YAAU;QAAK;QAExD,IAAA,wHAAM,EACJ,iBACA;YAAE,QAAQ;YAAQ,MAAM;QAAQ,GAChC,CAAC,KAAU;YACT,aAAa;YACb,IAAI,QAAQ;gBACV,iRAAK,CAAC,OAAO,CAAC,KAAK,WAAW;gBAC9B,OAAO,IAAI,CAAC;YACd,OAAO;gBACL,iRAAK,CAAC,KAAK,CAAC,KAAK,WAAW;YAC9B;QACF;IAEJ;IAEA,WAAW;IACX,SAAS;QACP,IAAA,wHAAM,EAAC,eAAe;YAAE,QAAQ;QAAO,GAAG,CAAC,KAAK;YAC9C,+BAA+B;YAC/B,OAAO,QAAQ,CAAC,IAAI,GAAG;YACvB,QAAQ,GAAG,CAAC;YACZ,aAAa,KAAK;QACpB;IACF;IACA,qBACE,6WAAC,YAAY,QAAQ;QACnB,OAAO;YACL;YACA;YACA;YACA;YACA;YACA;YACA;YACA;QACF;kBAEC;;;;;;AAGP;AAGO,MAAM,UAAU;IACrB,MAAM,UAAU,IAAA,kVAAU,EAAC;IAC3B,IAAI,CAAC,SAAS;QACZ,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT"}}]
}